## 任务分析

你必须依序完成以下子步骤，并在最後调用 `analyze_task` 工具，将初步设计方案傳递给下一阶段。

1. **分析目的**

   - 读取并理解：
     ```
     任务说明：{description}
     任务要求与限制：{requirements}
     {tasksTemplate}
     ```
   - 确认：
     - 任务目标与预期成果
     - 技术挑战与关键决策点
     - 与现有系统／架構的整合需求

2. **识別专案架構**

   - 查看关键配置文件与结構：
     - 检视根目录结構和重要配置文件（package.json, tsconfig.json 等）
     - 如果 shrimp-rules.md 存在请详细阅读并参考
     - 分析主要的目录组织和模组划分
   - 辨识架構模式：
     - 识別核心设计模式和架構风格（MVC, MVVM, 微服務等）
     - 确定专案的分层结構和模组边界
   - 分析核心组件：
     - 研究主要类別/接口设计与依赖关係
     - 标记关键服務/工具类及其职责和用途
   - 记录既有模式：
     - 记录发现的代码组织方式和架構规律
     - 建立对专案技术棧和架構特性的深入理解

3. **收集资讯**  
   如有任何不确定或信心不足，**必做其一**：

   - 向用戶提问以厘清
   - 使用 `query_task`、`read_file`、`codebase_search`或其他类似的工具查询现有程序／架構
   - 使用 `web_search` 或其他网路搜尋工具查询不熟悉的概念或技术  
     禁止凭空臆测，所有资讯必可追溯来源。

4. **检查现有程序与结構**

   - 使用精确的搜索策略：
     - 利用 `read_file`、`codebase_search`或其他类似的工具查询与任务相关的现有实现方式
     - 寻找与当前任务功能类似的现有代码
     - 分析目录结構寻找相似功能模组
   - 分析代码风格与约定：
     - 检查现有组件的命名规則（驼峰式、蛇形等）
     - 确认注释风格和格式约定
     - 分析错误处理模式和日志记录方式
   - 记录并遵循发现的模式：
     - 详细记录代码模式和组织结構
     - 计划如何沿用这些模式进行设计
   - 判斷是否与现有功能重疊，并决定「重用」或「抽象重構」
   - **不得**先生成设计再查现有码；必须「先查再设」

5. **任务类型特定指南**

   根据任务特性，额外考慮以下特定指南：

   - **前端/UI 任务**：

     - 优先查看现有 UI 组件庫和设计系统
     - 分析页面布局结構和元件组合模式
     - 确认样式管理方式（CSS 模组、Styled Components 等）
     - 理解狀态管理和数据流模式

   - **后端 API 任务**：

     - 检查 API 路由结構和命名约定
     - 分析请求处理和中间件模式
     - 确认错误处理和响应格式标准
     - 理解授权/身份验证实现方式

   - **数据庫操作**：
     - 分析现有的数据访问模式和抽象层
     - 确认查询构建和事務处理方式
     - 理解关联关係处理和数据验证方法
     - 检查缓存策略和性能优化手段

6. **初步方案产出**
   - 根据上述，撰写「初步设计方案」：
     - 清楚标示 **事实**（来源） vs **推论**（选擇依据）
     - 禁止模糊语句，须为最终可交付成果
     - 确保方案与专案既有架構模式一致
     - 说明如何重用现有组件或遵循现有模式
   - 过程必须一步一步思考并梳理思绪，如果问题过於复杂可以利用`process_thought`来思考
   - **严重警告**：禁止一切`假设`与`猜测`与`幻想`，你必须透过一切你`可以使用的工具`来`收集资讯`
   - 调用工具：
     ```
     analyze_task({ summary: <任务摘要>, initialConcept: <初步构想> })
     ```

**现在开始调用 `analyze_task`，严禁不调用工具**
